<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Sensor</title>
</head>
<body onload="startup()">
å…‰çº¿å¼ºåº¦ï¼š<input id="light"></br>
è·ç¦»ï¼š<input id="proximity"></br>
é‡åŠ›ï¼š<textarea id="gravity" style="height: 100px; width: 500px; overflow: hidden"></textarea></br>
<!--ç£åŠ›ï¼š<textarea id="magnetometer" style="height: 100px; width: 500px; overflow: hidden"></textarea></br-->
<!--è§’é€Ÿåº¦ï¼š<textarea id="gyroscope" style="height: 100px; width: 500px; overflow: hidden"></textarea></br-->
å®šä½ï¼š<textarea id="gps" style="height: 100px; width: 500px; overflow: hidden"></textarea></br>
ç”»ç”»ğŸ¤£ï¼š<canvas id="canvas" width="600" height="600" style="border:solid black 1px;"></canvas></br>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    var sensor_num = 0;
    if (window.DeviceLightEvent){
        sensor_num ++;
        window.addEventListener('devicelight',function (event) {
            document.getElementById('light').value = event.value;
        })
    }
    if (window.DeviceProximityEvent || window.UserProximityEvent){
        sensor_num ++;
        window.addEventListener('userproximity',function (event){
            if (event.near){
                document.getElementById('proximity').value = 'near';
            } else{
                document.getElementById('proximity').value = 'far';
            }
        })
    }
    if (window.DeviceMotionEvent){
        sensor_num ++;
        window.addEventListener('devicemotion',deviceMotionHandler,false);
        function deviceMotionHandler(event) {
            var g = event.accelerationIncludingGravity;
            var str = 'xè½´'+g.x.toString()+'\n'+'yè½´'+g.y.toString()+'\n'+'zè½´'+g.z.toString();
            document.getElementById('gravity').value = str;
        }
    }
    //let magSensor = new Magnetometer({frequency:60});
    //magSensor.addEventListener('reading',e => {
    //    sensor_num ++;
    //    var str = 'xè½´'+magSensor.x.toString()+'\n'+'yè½´'+magSensor.y.toString()+'\n'+'zè½´'+magSensor.z.toString();
    //    document.getElementById('magnetometer').value = str;
    //});
    //magSensor.start();
    //let gyroscope = new Gyroscope({frequency: 60});
    //gyroscope.addEventListener('reading',e => {
    //    sensor_num ++;
    //    var str = 'xè½´'+gyroscope.x.toString()+'\n'+'yè½´'+gyroscope.y.toString()+'\n'+'zè½´'+gyroscope.z.toString();
    //   document.getElementById('gyroscope').value = str;
    //});
    //gyroscope.start();
    if (navigator.geolocation){
        sensor_num ++;
        navigator.geolocation.getCurrentPosition(function (pos) {
            var str = 'ç»åº¦:'+pos.coords.longitude.toString()+'\n'+'çº¬åº¦:'+pos.coords.latitude.toString();
            document.getElementById('gps').value = str;
        })
    }
    function startup() {
        var el = document.getElementsByTagName('canvas')[0];
        el.addEventListener('touchstart', handleStart, false);
        el.addEventListener('touchend', handleEnd, false);
        el.addEventListener('touchmove', handleMove, false);
    }
    //è·Ÿè¸ªæ–°çš„è§¦æ‘¸ç‚¹
    var ongoingTouches = [];
    function handleStart(evt) {
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0; i < touches.length; i++){
            ongoingTouches.push(copyTouch(touches[i]));
            var color = colorForTouch(touches[i]);
            ctx.beginPath();
            ctx.arc(touches[i].pageX-600,touches[i].pageY-100,4,0,2*Math.PI,false);
            //åœ¨èµ·ç‚¹ç”»ä¸€ä¸ªåœ†
            ctx.fillStyle = color;
            ctx.fill();
        }
    }
    //è§¦æ‘¸ç§»åŠ¨æ—¶
    function handleMove(evt) {
        evt.preventDefault();
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0;i < touches.length; i++){
            var color = colorForTouch(touches[i]);
            var idx = ongoingTouchIndexById(touches[i].identifier);

            if (idx >= 0){
                ctx.beginPath();
                ctx.moveTo(ongoingTouches[idx].pageX,ongoingTouches[idx].pageY);
                ctx.lineTo(touches[i].pageX,touches[i].pageY);
                ctx.lineWidth = 4;
                ctx.strokeStyle = color;
                ctx.stroke();

                ongoingTouches.splice(idx,1,copyTouch(touches[i]))//åˆ‡æ¢è§¦æ‘¸ä¿¡æ¯
            }
        }
    }
    //è§¦æ‘¸ç»“æŸå¤„ç†
    function handleEnd(evt) {
        evt.preventDefault();
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0;i < touches.length;i++){
            var color = colorForTouch(touches[i]);
            var idx = ongoingTouchIndexById(touches[i].identifier);

            if (idx >= 0){
                ctx.lineWidth = 4;
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(ongoingTouches[idx].pageX,ongoingTouches[idx].pageY);
                ctx.lineTo(touches[i].pageX,touches[i].pageY);
                ctx.fillRect(touches[i].pageX-4, touches[i].pageY-4,8,8);
                //ç»ˆç‚¹ç”»ä¸ªæ­£æ–¹å½¢
                ongoingTouches.splice(idx,1);//ç”¨å®Œåç§»é™¤
            }
        }
    }
    //ä¸ºè§¦æ‘¸ç‚¹è®¾ç½®é¢œè‰²
    function colorForTouch(touch) {
        var r = touch.identifier %16;
        var g = Math.floor(touch.identifier / 3)%16;
        var b = Math.floor(touch.identifier / 7)%16;
        r = r.toString(16);// è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
        g = g.toString(16);
        b = b.toString(16);
        var color = '#'+r+g+b;
        return color;
    }
    //å¤åˆ¶è§¦æ‘¸å¯¹è±¡
    function copyTouch(touch) {
        return {identifier:touch.identifier,pageX:touch.pageX,pageY:touch.pageY};
    }
    //æŸ¥æ‰¾è§¦æ‘¸ç‚¹
    function ongoingTouchIndexById(idToFind) {
        for (var i=0;i<ongoingTouches.length;i++){
            var id=ongoingTouches[i].identifier;

            if (id == idToFind){return i;}
        }
        return -1;//æœªæ‰¾åˆ°
    }
    alert(sensor_num.toString()+'\nè§¦å±åŠŸèƒ½éœ€è¦è‚‰çœ¼åˆ¤æ–­');
</script>
</body>
</html>
