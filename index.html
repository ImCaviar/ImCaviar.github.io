<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Sensor</title>
</head>
<body onload="startup()">
光线强度：<input id="light"></br>
距离：<input id="proximity"></br>
重力：<textarea id="gravity" style="height: 100px; width: 500px; overflow: hidden"></textarea></br>
<!--磁力：<textarea id="magnetometer" style="height: 100px; width: 500px; overflow: hidden"></textarea></br-->
<!--角速度：<textarea id="gyroscope" style="height: 100px; width: 500px; overflow: hidden"></textarea></br-->
定位：<textarea id="gps" style="height: 100px; width: 500px; overflow: hidden"></textarea></br>
画画🤣：<canvas id="canvas" width="600" height="600" style="border:solid black 1px;"></canvas></br>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    var sensor_num = 0;
    if (window.DeviceLightEvent){
        sensor_num ++;
        window.addEventListener('devicelight',function (event) {
            document.getElementById('light').value = event.value;
        })
    }
    if (window.DeviceProximityEvent || window.UserProximityEvent){
        sensor_num ++;
        window.addEventListener('userproximity',function (event){
            if (event.near){
                document.getElementById('proximity').value = 'near';
            } else{
                document.getElementById('proximity').value = 'far';
            }
        })
    }
    if (window.DeviceMotionEvent){
        sensor_num ++;
        window.addEventListener('devicemotion',deviceMotionHandler,false);
        function deviceMotionHandler(event) {
            var g = event.accelerationIncludingGravity;
            var str = 'x轴'+g.x.toString()+'\n'+'y轴'+g.y.toString()+'\n'+'z轴'+g.z.toString();
            document.getElementById('gravity').value = str;
        }
    }
    //let magSensor = new Magnetometer({frequency:60});
    //magSensor.addEventListener('reading',e => {
    //    sensor_num ++;
    //    var str = 'x轴'+magSensor.x.toString()+'\n'+'y轴'+magSensor.y.toString()+'\n'+'z轴'+magSensor.z.toString();
    //    document.getElementById('magnetometer').value = str;
    //});
    //magSensor.start();
    //let gyroscope = new Gyroscope({frequency: 60});
    //gyroscope.addEventListener('reading',e => {
    //    sensor_num ++;
    //    var str = 'x轴'+gyroscope.x.toString()+'\n'+'y轴'+gyroscope.y.toString()+'\n'+'z轴'+gyroscope.z.toString();
    //   document.getElementById('gyroscope').value = str;
    //});
    //gyroscope.start();
    if (navigator.geolocation){
        sensor_num ++;
        navigator.geolocation.getCurrentPosition(function (pos) {
            var str = '经度:'+pos.coords.longitude.toString()+'\n'+'纬度:'+pos.coords.latitude.toString();
            document.getElementById('gps').value = str;
        })
    }
    function startup() {
        var el = document.getElementsByTagName('canvas')[0];
        el.addEventListener('touchstart', handleStart, false);
        el.addEventListener('touchend', handleEnd, false);
        el.addEventListener('touchmove', handleMove, false);
    }
    //跟踪新的触摸点
    var ongoingTouches = [];
    function handleStart(evt) {
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0; i < touches.length; i++){
            ongoingTouches.push(copyTouch(touches[i]));
            var color = colorForTouch(touches[i]);
            ctx.beginPath();
            ctx.arc(touches[i].pageX-600,touches[i].pageY-100,4,0,2*Math.PI,false);
            //在起点画一个圆
            ctx.fillStyle = color;
            ctx.fill();
        }
    }
    //触摸移动时
    function handleMove(evt) {
        evt.preventDefault();
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0;i < touches.length; i++){
            var color = colorForTouch(touches[i]);
            var idx = ongoingTouchIndexById(touches[i].identifier);

            if (idx >= 0){
                ctx.beginPath();
                ctx.moveTo(ongoingTouches[idx].pageX,ongoingTouches[idx].pageY);
                ctx.lineTo(touches[i].pageX,touches[i].pageY);
                ctx.lineWidth = 4;
                ctx.strokeStyle = color;
                ctx.stroke();

                ongoingTouches.splice(idx,1,copyTouch(touches[i]))//切换触摸信息
            }
        }
    }
    //触摸结束处理
    function handleEnd(evt) {
        evt.preventDefault();
        var el = document.getElementsByTagName('canvas')[0];
        var ctx = el.getContext('2d');
        var touches = evt.changedTouches;

        for (var i = 0;i < touches.length;i++){
            var color = colorForTouch(touches[i]);
            var idx = ongoingTouchIndexById(touches[i].identifier);

            if (idx >= 0){
                ctx.lineWidth = 4;
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(ongoingTouches[idx].pageX,ongoingTouches[idx].pageY);
                ctx.lineTo(touches[i].pageX,touches[i].pageY);
                ctx.fillRect(touches[i].pageX-4, touches[i].pageY-4,8,8);
                //终点画个正方形
                ongoingTouches.splice(idx,1);//用完后移除
            }
        }
    }
    //为触摸点设置颜色
    function colorForTouch(touch) {
        var r = touch.identifier %16;
        var g = Math.floor(touch.identifier / 3)%16;
        var b = Math.floor(touch.identifier / 7)%16;
        r = r.toString(16);// 转换为十六进制字符串
        g = g.toString(16);
        b = b.toString(16);
        var color = '#'+r+g+b;
        return color;
    }
    //复制触摸对象
    function copyTouch(touch) {
        return {identifier:touch.identifier,pageX:touch.pageX,pageY:touch.pageY};
    }
    //查找触摸点
    function ongoingTouchIndexById(idToFind) {
        for (var i=0;i<ongoingTouches.length;i++){
            var id=ongoingTouches[i].identifier;

            if (id == idToFind){return i;}
        }
        return -1;//未找到
    }
    alert(sensor_num.toString()+'\n触屏功能需要肉眼判断');
</script>
</body>
</html>
